# CLAUDE.md
<!-- Generated by Claude Conductor v1.1.2 -->

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Critical Context (Read First)
- **Tech Stack**: Python 3.10+, PyTorch, Transformers, Audio Processing
- **Main File**: boson_multimodal/model/higgs_audio/modeling_higgs_audio.py (2,289 lines)
- **Core Mechanic**: Audio generation model with 9,749 lines of code across 37 files
- **Key Integration**: HuggingFace Hub, AWS S3 (via boto3, s3fs), Docker deployment
- **Platform Support**: NVIDIA GPU (24GB+ VRAM recommended), Linux/Unix
- **DO NOT**: Expose model weights, hardcode API keys, or share sensitive configuration

## Session Startup Checklist
**IMPORTANT**: At the start of each session, check these items:
1. **Check TASKS.md** - Look for any IN_PROGRESS or BLOCKED tasks from previous sessions
2. **Review recent JOURNAL.md entries** - Scan last 2-3 entries for context
3. **If resuming work**: Load the current task context from TASKS.md before proceeding

## Table of Contents
1. [Architecture](ARCHITECTURE.md) - Tech stack, folder structure, infrastructure
2. [Design Tokens](DESIGN.md) - Colors, typography, visual system
3. [UI/UX Patterns](UIUX.md) - Components, interactions, accessibility
4. [Runtime Config](CONFIG.md) - Environment variables, feature flags
5. [Data Model](DATA_MODEL.md) - Database schema, entities, relationships
6. [API Contracts](API.md) - Endpoints, request/response formats, auth
7. [Build & Release](BUILD.md) - Build process, deployment, CI/CD
8. [Testing Guide](TEST.md) - Test strategies, E2E scenarios, coverage
9. [Operational Playbooks](PLAYBOOKS/DEPLOY.md) - Deployment, rollback, monitoring
10. [Contributing](CONTRIBUTING.md) - Code style, PR process, conventions
11. [Error Ledger](ERRORS.md) - Critical P0/P1 error tracking
12. [Task Management](TASKS.md) - Active tasks, phase tracking, context preservation

## Quick Reference
**Main Constants**: `boson_multimodal/constants.py` - Global configuration constants  
**Core Class**: `boson_multimodal/model/higgs_audio/modeling_higgs_audio.py:100-500` - HiggsAudioModel main implementation  
**Key Function**: `boson_multimodal/serve/serve_engine.py:50-150` - HiggsAudioServeEngine.generate()  
**Audio Tokenizer**: `boson_multimodal/audio_processing/higgs_audio_tokenizer.py:1-100` - Audio tokenization  
**Data Types**: `boson_multimodal/data_types.py:1-200` - ChatMLSample, Message, AudioContent  
**Config**: `boson_multimodal/model/higgs_audio/configuration_higgs_audio.py:1-150` - Model configuration  
**Utils**: `boson_multimodal/model/higgs_audio/utils.py:1-100` - Utility functions  
**CUDA Runner**: `boson_multimodal/model/higgs_audio/cuda_graph_runner.py:1-80` - CUDA optimization  
**Collator**: `boson_multimodal/data_collator/higgs_audio_collator.py:1-120` - Training data collation  
**Dataset**: `boson_multimodal/dataset/chatml_dataset.py:1-200` - ChatML dataset loading  
**Engine Utils**: `boson_multimodal/serve/utils.py:1-100` - Serving utilities  
**Custom Modules**: `boson_multimodal/model/higgs_audio/custom_modules.py:1-150` - Custom neural modules  
**Semantic Module**: `boson_multimodal/semantic_module.py:1-80` - Semantic processing  
**Common**: `boson_multimodal/model/higgs_audio/common.py:1-100` - Common utilities

## Current State
- [x] Feature complete - Higgs Audio V2 model implementation
- [x] Audio tokenizer implementation
- [x] Serve engine for inference
- [x] Multi-speaker dialogue support
- [x] Zero-shot voice cloning
- [x] Examples and documentation
- [x] GPU optimization with CUDA
- [ ] Feature in progress
- [ ] Feature planned

## Development Workflow
[5-6 steps for common workflow]

## Task Templates
### 1. [Common Task Name]
1. Step with file:line reference
2. Step with specific action
3. Test step
4. Documentation update

[Include 3-5 templates]

## Anti-Patterns (Avoid These)
‚ùå **Don't [action]** - [Reason]  
[List 5-6 critical mistakes]

## Journal Update Requirements
**IMPORTANT**: Update JOURNAL.md regularly throughout our work sessions:
- After completing any significant feature or fix
- When encountering and resolving errors
- At the end of each work session
- When making architectural decisions
- Format: What/Why/How/Issues/Result structure

## Task Management Integration
**How TASKS.md and JOURNAL.md work together**:
1. **Active Work**: TASKS.md tracks current/incomplete tasks with full context
2. **Completed Work**: When tasks complete, they generate JOURNAL.md entries with `|TASK:ID|` tags
3. **History**: JOURNAL.md preserves complete task history even if Claude Code is reinstalled
4. **Context Recovery**: Search JOURNAL.md for `|TASK:` to see all completed tasks over time
5. **Clean Handoffs**: TASKS.md always shows what needs to be resumed or completed

## Version History
- **v1.0.0** - Initial release
- **v1.1.0** - Feature added (see JOURNAL.md YYYY-MM-DD)  
[Link major versions to journal entries]